C:\Documents and Settings\micro\Mes documents\µC\dubus\tp5\tp5-1.lst - generated by MGTEK Assembler ASM12 V1.26 Build 144 for WIN32 (x86) - Thu Oct 11 00:05:55 2012

    1:          =00001000                   CODE    EQU     $1000
    2:          =00002000                   DATA    EQU     $2000
    3:          =00000040                   TIOS    EQU     $0040
    4:          =00000046                   TSCR1   EQU     $0046
    5:          =0000004D                   TSCR2   EQU     $004D
    6:          =00000048                   TCTL1   EQU     $0048
    7:          =00000049                   TCTL2   EQU     $0049
    8:          =0000004A                   TCTL3   EQU     $004A
    9:          =0000004B                   TCTL4   EQU     $004B
   10:          =0000004E                   TFLG1   EQU     $004E
   11:          =00000050                   TC0     EQU     $0050
   12:          =00000052                   TC1     EQU     $0052
   13:                                      
   14:          =00000001                   PORTB   EQU     $0001
   15:          =00000003                   DDRB    EQU     $0003
   16:                                      
   17:          =00002000                           ORG     DATA
   18:     2000 +0002                       VAR     DS.W    1
   19:     2002 +0002                       CMPT    DS.W    1
   20:                                      
   21:          =00001000                           ORG     CODE
   22:                                      
   23:     1000 CC 0000                [02] INIT    LDD     #$0000
   24:     1003 7C 2000                [03]         STD     VAR
   25:                                      
   26:     1006 86 80                  [01] INIT_TIMER      LDAA    #$80    ;On initialise le timer
   27:     1008 5A 46                  [02]         STAA    TSCR1   ;On met TEN à 1
   28:                                              
   29:     100A 86 07                  [01]         LDAA    #$07    ;
   30:     100C 5A 4D                  [02]         STAA    TSCR2   ;On met le prédiviseur à 128
   31:                                      
   32:     100E 86 00                  [01]         LDAA    #$00    ;
   33:     1010 5A 40                  [02]         STAA    TIOS    ;On met tous les canaux en capture d'entrée
   34:                                              
   35:     1012 86 0A                  [01]         LDAA    #$0A    ;
   36:     1014 5A 4B                  [02]         STAA    TCTL4   ;On met le trigger du timer sur front descendant pour TC0 et TC1
   37:                                      
   38:     1016 96 4E                  [03] BOUCLE  LDAA    TFLG1   ;On récupère les flags du timer
   39:     1018 84 03                  [01]         ANDA    #$03    ;On masque pour ne récupérer que TC0 et TC1
   40:     101A 81 03                  [01]         CMPA    #$03    ;On teste
   41:     101C 26 F8                  [03]         BNE     BOUCLE  ;Si les deux ne sont pas levés, on recommence
   42:     101E C6 03                  [01]         LDAB    #$03    ;
   43:     1020 5B 4E                  [02]         STAB    TFLG1   ;Si ils sont levés, on les remets à 0 en passant 1
   44:                                      
   45:     1022 DC 52                  [03] DIFF    LDD     TC1     ;On récupère le temps de fin (TC1)
   46:     1024 93 50                  [03]         SUBD    TC0     ;On le soustrait au temps de départ
   47:     1026 7C 2000                [03]         STD     VAR     ;On stocke la différence dans la variable
   48:                                              
   49:     1029 CE 03E8                [02]         LDX     #$03E8  ;On divise par 1000 pour avoir les microsecondes.
   50:     102C 1810                   [0C]         IDIV
   51:     102E 7E 2002                [03]         STX     CMPT
   52:                                      
   53:                                              
   54:     1031 3F                     [09]         SWI

Symbols:
boucle                          *00001016
cmpt                            *00002002
code                            *00001000
data                            *00002000
tc0                             *00000050
tc1                             *00000052
tctl4                           *0000004b
tflg1                           *0000004e
tios                            *00000040
tscr1                           *00000046
tscr2                           *0000004d
var                             *00002000

